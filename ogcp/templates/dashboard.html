{% extends 'base.html' %}

{% block nav_dashboard %}active{% endblock %}

{% block content %}
<div class="row">
  <!-- connected clients -->
  <div class="col-{{ colsize }}">
    <div class="card text-center">
      <div class="card-header">
        {{ _('Connected clients (ogClient)') }}
      </div>
      <div class="card-body">
        <p class="card-text">{{ clients['clients'] | length }}</p>
      </div>
    </div>
  </div>

  <!-- latest images -->
  <div class="col-{{ colsize }}">
    <div class="card text-center">
      <div class="card-header">
        {{ _('Latest images') }}
      </div>
        {% for image in images[:10] %}
          <ul class="list-group list-group-horizontal">
            <li class="list-group-item w-50">
              {{ image['name'] }}
            </li>
            <li class="list-group-item w-50">
              {{ image['modified'] }}
            </li>
          </ul>
        {% endfor %}
    </div>
  </div>

  <!-- disk stats -->
  <div class="col-{{ colsize }}">
    <div class="card text-center">
      <div class="card-header">
        {{ _('Disk stats') }}
      </div>
      <div class="card-body">
        <canvas id="diskChart" class="mb-2"></canvas>
        <ul class="list-group list-group-horizontal">
          <li class="list-group-item w-50">
            {{ _('Disk size') }}
          </li>
          <li class="list-group-item w-50">
            {{ _('used') }}
          </li>
          <li class="list-group-item w-50">
            {{ _('available') }}
          </li>
          <li class="list-group-item w-50">
            {{ _('use') }}(%)
          </li>
        </ul>
        <ul class="list-group list-group-horizontal">
          <li class="list-group-item w-50">
            {{ disk['total'] // 2**30 }} Gbytes
          </li>
          <li class="list-group-item w-50">
            {{ (disk['total'] - disk['free']) // 2**30 }} Gbytes
          </li>
          <li class="list-group-item w-50">
            {{ disk['free'] // 2**30 }} Gbytes
          </li>
          <li class="list-group-item w-50">
            {{ (((disk['total'] - disk['free']) / disk['total']) * 100)|int }}%
          </li>
        </ul>
      </div>
      <div class="card-header">
        {{ _('Number of images') }}
      </div>
      <div class="card-body">
        <p class="card-text">{{ images | length }}</p>
      </div>
    </div>
  </div>

  <!-- ogLives -->
  <div class="col-{{ colsize }}">
    <div class="card text-center">
      <div class="card-header">
        ogLives
      </div>
        <ul class="list-group">
          {% for oglive in oglive_list['oglive'] %}
            <li class="list-group-item">
              {{ oglive['directory'] }}
            {% if loop.index0 == oglive_list['default'] %}
              ({{ _('default') }})
            {% endif %}
            </li>
          {% endfor %}
        </ul>
    </div>
  </div>
</div>
{% endblock %}

{% block extrabody %}
<script>
  const diskChartConfig = {
    type: 'doughnut',
    data: {
      labels: ['Used', 'Available'],
      datasets: [
        {
          label: 'Disk usage',
          data: [
            {{ (disk['total'] - disk['free']) // 2**30 }},
            {{ disk['free'] // 2**30 }},
          ],
          backgroundColor: [
            'rgb(255, 99, 132)',
            'rgb(54, 162, 235)',
          ],
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        title: {
          display: true,
          text: 'Chart.js Doughnut Chart'
        },
      },
    },
  };
  var diskChart = new Chart(
    document.getElementById('diskChart'),
    diskChartConfig,
  );
</script>
{% endblock %}
